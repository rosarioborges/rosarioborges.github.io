<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel do Vendedor</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Painel do Vendedor</h1>

  <div class="card">
    <h2>Gerenciar Terços</h2>
    <input type="text" id="nome" placeholder="Nome do terço" />
    <input type="text" id="descricao" placeholder="Descrição" />
    <input type="number" id="preco" placeholder="Preço (ex: 25.90)" step="0.01" />
    <input type="file" id="imagem" accept="image/*" />
    <button onclick="adicionarTerco()">Adicionar</button>
  </div>

  <script>
    const SUPABASE_URL = "https://vovfzdppsrxxikqcipky.supabase.co"; // substitua pelo seu
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvdmZ6ZHBwc3J4eGlrcWNpcGt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NTUxNDgsImV4cCI6MjA3NzQzMTE0OH0.utUG4vFnpgGd5OSsqw8Q-ulU34dKkh-Z59bg8mHzetw";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function adicionarTerco() {
      const nome = document.getElementById('nome').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const preco = document.getElementById('preco').value.trim();
      const imagem = document.getElementById('imagem').files[0];

      if (!nome || !descricao || !preco || !imagem) {
        alert("Preencha todos os campos e selecione uma imagem!");
        return;
      }

      try {
        // Upload da imagem para o bucket
        const nomeArquivo = `${Date.now()}_${imagem.name}`;
        const { error: uploadError } = await supabase.storage
          .from('imagem_tercos') // <--- use o nome EXATO do seu bucket aqui
          .upload(nomeArquivo, imagem);

        if (uploadError) throw uploadError;

        // Gerar URL pública da imagem
        const { data } = supabase.storage
          .from('imagem_tercos')
          .getPublicUrl(nomeArquivo);

        const imagemUrl = data.publicUrl;

        // Inserir dados na tabela
        const { error: insertError } = await supabase
          .from('tercos')
          .insert([{ nome, descricao, preco, imagem_url: imagemUrl }]);

        if (insertError) throw insertError;

        alert("✅ Terço adicionado com sucesso!");
        document.getElementById('nome').value = '';
        document.getElementById('descricao').value = '';
        document.getElementById('preco').value = '';
        document.getElementById('imagem').value = '';
      } catch (err) {
        console.error(err);
        alert("Erro ao adicionar: " + err.message);
      }
    }
  </script>
</body>
</html>
