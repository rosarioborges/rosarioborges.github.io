<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel do Vendedor - Ros√°rio Borges</title>

   <!-- Bootstrap CSS (carregado primeiro, sem interfer√™ncia) -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
    crossorigin="anonymous"
  >

  <!-- Opcional: √≠cones Bootstrap -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" 
    rel="stylesheet"
  >
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-light">

  <div class="container py-5">
    <h1 class="text-center mb-4">Painel do Vendedor</h1>

    <!-- Login -->
    <div id="login" class="card mx-auto shadow-sm" style="max-width: 400px;">
      <div class="card-body">
        <h4 class="card-title mb-3 text-center">Login</h4>
        <input type="password" id="senha" class="form-control mb-3" placeholder="Digite a senha">
        <button class="btn btn-primary w-100" onclick="login()">Entrar</button>
      </div>
    </div>

    <!-- Painel -->
    <div id="painel" style="display:none;">
      <div class="card shadow-sm mt-5">
        <div class="card-body">
          <h4 class="card-title mb-3">Gerenciar Ter√ßos</h4>

          <div class="row g-3 mb-4">
            <div class="col-md-3">
              <input type="text" id="nome" class="form-control" placeholder="Nome do ter√ßo">
            </div>
            <div class="col-md-3">
              <input type="text" id="descricao" class="form-control" placeholder="Descri√ß√£o">
            </div>
            <div class="col-md-2">
              <input type="number" id="preco" class="form-control" placeholder="Pre√ßo">
            </div>
            <div class="col-md-3">
              <input type="file" id="imagem" class="form-control" accept="image/*">
            </div>
            <div class="col-md-1 d-grid">
              <button class="btn btn-success" onclick="adicionarTerco()">+</button>
            </div>
          </div>

          <div class="table-responsive">
            <table id="tabela-tercos" class="table table-striped align-middle">
              <thead class="table-dark">
                <tr>
                  <th>Imagem</th>
                  <th>Nome</th>
                  <th>Descri√ß√£o</th>
                  <th>Pre√ßo</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const SENHA = "2010Hbs13";

    function login() {
      const senha = document.getElementById("senha").value;
      if (senha === SENHA) {
        document.getElementById("login").style.display = "none";
        document.getElementById("painel").style.display = "block";
        carregarTercos();
      } else {
        alert("Senha incorreta!");
      }
    }

    const SUPABASE_URL = "https://vovfzdppsrxxikqcipky.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvdmZ6ZHBwc3J4eGlrcWNpcGt5Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTg1NTE0OCwiZXhwIjoyMDc3NDMxMTQ4fQ.4NVB4fyLYSj30n8kEN3N01GdnEZXY0LBBQ_4CIqy6C4";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function adicionarTerco() {
      const nome = document.getElementById("nome").value.trim();
      const descricao = document.getElementById("descricao").value.trim();
      const preco = document.getElementById("preco").value.trim();
      const imagem = document.getElementById("imagem").files[0];

      if (!nome || !descricao || !preco || !imagem) {
        alert("Preencha todos os campos e selecione uma imagem!");
        return;
      }

      try {
        const nomeArquivo = `${Date.now()}_${imagem.name}`;
        const { error: uploadError } = await supabase.storage.from("imagem_tercos").upload(nomeArquivo, imagem);
        if (uploadError) throw uploadError;

        const { data } = supabase.storage.from("imagem_tercos").getPublicUrl(nomeArquivo);
        const imagemUrl = data.publicUrl;

        const { error: insertError } = await supabase
          .from("tercos")
          .insert([{ nome, descricao, preco, imagem_url: imagemUrl }]);

        if (insertError) throw insertError;

        alert("‚úÖ Ter√ßo adicionado com sucesso!");
        document.getElementById("nome").value = "";
        document.getElementById("descricao").value = "";
        document.getElementById("preco").value = "";
        document.getElementById("imagem").value = "";
        carregarTercos();
      } catch (err) {
        console.error(err);
        alert("Erro ao adicionar: " + err.message);
      }
    }

    async function carregarTercos() {
      const { data, error } = await supabase.from("tercos").select("*").order("id", { ascending: false });
      if (error) return console.error(error);

      const tbody = document.querySelector("#tabela-tercos tbody");
      tbody.innerHTML = "";
      data.forEach(t => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><img src="${t.imagem_url}" width="60" height="60" class="rounded"></td>
          <td>${t.nome}</td>
          <td>${t.descricao}</td>
          <td>R$ ${Number(t.preco).toFixed(2)}</td>
          <td><button class="btn btn-sm btn-danger" onclick="removerTerco('${t.id}')">Remover</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function removerTerco(id) {
      if (!confirm("Tem certeza que deseja remover este ter√ßo?")) return;
      const { error } = await supabase.from("tercos").delete().eq("id", id);
      if (error) return alert("Erro ao remover: " + error.message);
      alert("üóëÔ∏è Ter√ßo removido com sucesso!");
      carregarTercos();
    }
  </script>
</body>
</html>
